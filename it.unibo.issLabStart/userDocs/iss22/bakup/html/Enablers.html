
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

    <title>Abilitatori di comunicazione &#8212; iss22 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contesti-contenitori" href="ContestiContenitori.html" />
    <link rel="prev" title="Supporti per comunicazioni" href="RadarSystemSupporti.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="abilitatori-di-comunicazione">
<h1>Abilitatori di comunicazione<a class="headerlink" href="#abilitatori-di-comunicazione" title="Permalink to this headline">¶</a></h1>
<p>L’analisi del problema ha posto in evidenza (si veda <a class="reference internal" href="RadarSystemProdottiAnalisi.html#concettodienabler"><span class="std std-ref">Il concetto di ‘oggetto enabler’</span></a>)
la opportunità/necessità,
di introdurre nel sistema degli <span class="blue">enabler</span>, che hanno lo scopo di fornire funzionalità
di ricezione/trasmissione di informazione su rete a un nucleo di
<em>core-code</em> incapsulato al proprio interno.</p>
<p>Nell’ambito di un processo di sviluppo bottom-up in cui il procollo TCP è
la tecnologia di riferimento per le comunicazioni, risulta naturale pensare subito a
un enabler <em>tipo-server</em> capace di ricevere richieste  da parte di client remoti (normalmente
dei Proxy).</p>
<p>Come suggerito nell’analisi, ponendo il <code class="docutils literal notranslate"><span class="pre">Controller</span></code> su PC,
possiamo  (senza modificare il codice introdotto in <a class="reference internal" href="RadarSystemProgetto.html#controller"><span class="std std-ref">Controller</span></a>)
impostare una architettura come quella rappresentata in figura:</p>
<a class="reference internal image-reference" href="_images/ArchLogicaOOPEnablersBetter.PNG"><img alt="_images/ArchLogicaOOPEnablersBetter.PNG" class="align-center" src="_images/ArchLogicaOOPEnablersBetter.PNG" style="width: 50%;" /></a>
<p>Ricordando la proposta delle architetture  <a class="reference external" href="https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)">port-adapter</a>,  decidiamo, come progettisti,
di proseguire lo sviluppo del software del sistema con riferimento ad una architettura a livelli
rappresentata come segue:</p>
<a class="reference internal image-reference" href="_images/cleanArchCone.jpg"><img alt="_images/cleanArchCone.jpg" class="align-center" src="_images/cleanArchCone.jpg" style="width: 50%;" /></a>
<section id="enabler-tipo-server">
<span id="enabler"></span><h2>Enabler tipo-server<a class="headerlink" href="#enabler-tipo-server" title="Permalink to this headline">¶</a></h2>
<p>Iniziamo con il definire un enabler <em>tipo-server</em> che demanda la gestione dei messaggi ricevuti
ad oggetti di una classe che implementa <a class="reference internal" href="RadarSystemSupporti.html#iapplmsghandler"><span class="std std-ref">L’interfaccia IApplMsgHandler</span></a>.</p>
<a class="reference internal image-reference" href="_images/EnablerAsServer.PNG"><img alt="_images/EnablerAsServer.PNG" class="align-center" src="_images/EnablerAsServer.PNG" style="width: 60%;" /></a>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EnablerAsServer</span><span class="p">{</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="kd">protected</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kd">protected</span> <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">;</span>
  <span class="kd">protected</span> <span class="n">TcpServer</span> <span class="n">serverTcp</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">EnablerAsServer</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span>
                     <span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">IApplMsgHandler</span> <span class="n">handler</span> <span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">name</span>                         <span class="o">=</span> <span class="n">name</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">protocol</span>                     <span class="o">=</span> <span class="n">protocol</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">protocol</span> <span class="o">!=</span> <span class="kc">null</span> <span class="p">)</span> <span class="n">setServerSupport</span><span class="p">(</span> <span class="n">port</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">handler</span> <span class="p">);</span>
    <span class="p">}</span><span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">setServerSupport</span><span class="p">(</span><span class="kt">int</span> <span class="n">port</span><span class="p">,</span><span class="n">ProtocolType</span> <span class="n">protocol</span><span class="p">,</span>
                    <span class="n">IApplMsgHandler</span> <span class="n">handler</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">protocol</span> <span class="o">==</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span> <span class="p">)</span> <span class="p">{</span>
        <span class="n">serverTcp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TcpServer</span><span class="p">(</span> <span class="s">&quot;EnabSrvTcp_&quot;</span><span class="o">+</span><span class="n">count</span><span class="o">++</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">handler</span> <span class="p">);</span>
    <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">protocol</span> <span class="o">==</span> <span class="p">...</span> <span class="p">)</span> <span class="p">{</span> <span class="p">...</span>  <span class="p">}</span>
    <span class="p">...</span>
  <span class="p">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">activate</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">protocol</span> <span class="o">==</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">serverTcp</span><span class="p">.</span><span class="na">activate</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span>  <span class="p">...</span>
  <span class="p">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">protocol</span> <span class="o">==</span> <span class="n">ProtocolType</span><span class="p">.</span><span class="na">tcp</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">serverTcp</span><span class="p">.</span><span class="na">deactivate</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span> <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Notiamo che:</p>
<ul class="simple">
<li><p>nel caso <code class="docutils literal notranslate"><span class="pre">protocol==null</span></code>, non viene creato alcun supporto.
Questo caso sarà applicato più avanti, nella sezione  <a class="reference internal" href="ContestiContenitori.html"><span class="doc">Contesti-contenitori</span></a>.</p></li>
<li><p>si prevede anche la possibilità di utilizzare altri protocolli
.. un supporto per il protocollo CoAP (<a class="reference internal" href="RadarSystemCoap.html"><span class="doc">Il RadarSystem con CoAP</span></a>), di cui parleremo nella sezione <a class="reference internal" href="RadarGuiCoap.html"><span class="doc">RadarGuiCoap</span></a>.</p></li>
</ul>
</section>
<section id="interpreti">
<span id="iapplintepreternoctx"></span><h2>Interpreti<a class="headerlink" href="#interpreti" title="Permalink to this headline">¶</a></h2>
<p>Ogni enabler deve ricevere in ingresso un gestore  applicativo (handler) che implementa <a class="reference internal" href="RadarSystemSupporti.html#iapplmsghandler"><span class="std std-ref">L’interfaccia IApplMsgHandler</span></a> estendendo
la classe <a class="reference internal" href="RadarSystemSupporti.html#applmsghandler"><span class="std std-ref">ApplMsgHandler</span></a>. L’handler deve definire il metodo <code class="docutils literal notranslate"><span class="pre">elaborate</span></code> che gestisce
i comandi o le richieste ricevute dal sever in forma di messaggi.</p>
<p>L’handler deve quindi fare fronte a due compiti:</p>
<ol class="arabic simple">
<li><p>interpretare un messagio e tradurlo in un comando o richiesta al dispositivo Sonar</p></li>
<li><p>inviare al mittente la risposta, in caso il messaggio sia una richiesta</p></li>
</ol>
<p>Facendo riferimento al single responsibility principle (SRP), conviene delegare il primo compito ad
un componente che non ‘sappia nulla’ della <em>dimensione interazione</em> e che si occupi solo della
interpretazione del messaggio. Introduciamo una interfaccia per componenti di questo tipo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IApplIntepreter</span> <span class="p">{</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">elaborate</span><span class="p">(</span> <span class="n">String</span> <span class="n">message</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="linguaggio-di-comando">
<span id="linguaggiocomando"></span><h3>Linguaggio di comando<a class="headerlink" href="#linguaggio-di-comando" title="Permalink to this headline">¶</a></h3>
<p>In questo nostro semplice sistema, la String message rappresenta un comando o una richiesta e segue la sintassi di
una  <a class="reference external" href="https://it.wikipedia.org/wiki/Grammatica_regolare">grammatica regolare</a> che può essere definita mediante le seguenti regole in <a class="reference external" href="https://it.wikipedia.org/wiki/Backus-Naur_Form">BackusNaur Form</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MSG</span>          <span class="p">:</span><span class="o">:=</span>  <span class="n">LEDMSG</span>   <span class="o">|</span> <span class="n">SONARMSG</span>
<span class="n">LEDMSG</span>       <span class="p">:</span><span class="o">:=</span>  <span class="n">LEDCMD</span>   <span class="o">|</span> <span class="n">LEDREQUEST</span>
<span class="n">SONARMSG</span>     <span class="p">:</span><span class="o">:=</span>  <span class="n">SONARCMD</span> <span class="o">|</span> <span class="n">SONARREQUEST</span>
<span class="n">LEDCMD</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;on&quot;</span> <span class="o">|</span> <span class="s2">&quot;off&quot;</span>
<span class="n">LEDREQUEST</span>   <span class="p">:</span><span class="o">:=</span>  <span class="s2">&quot;getState&quot;</span>
<span class="n">SONARCMD</span>     <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;activate&quot;</span> <span class="o">|</span> <span class="s2">&quot;deactivate&quot;</span>
<span class="n">SONARREQUEST</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;getDistance&quot;</span>   <span class="o">|</span>  <span class="s2">&quot;isActive&quot;</span>
</pre></div>
</div>
<p>Concettualmente, dobbiamo fare ora riferimento al <a class="reference external" href="https://it.wikipedia.org/wiki/Interpreter_pattern">pattern interpreter</a> .
Tuttavia, la semplicità di questo linguaggio non richiede al momento approfondimenti di tecniche
per il riconoscimento e la esecuzione di frasi: basteranno dei semplici <code class="docutils literal notranslate"><span class="pre">if</span></code>,
come vederemo nelle sezioni successive.</p>
<p>Occorre però segnalare un punto importante: stiamo introducendo l’idea che si possa interagire
con un componente software (nel nostro caso con un dispositivo di I/O) ‘parlando’ con tale componente,
invece che invocarne un metodo.</p>
<p>Il linguaggio con cui comunicare con il componente potrebbe essere, in applicazioni future, molto
più articolato dell’attuale, tanto da porci di fronte a questioni come il famoso <a class="reference external" href="https://it.wikipedia.org/wiki/Test_di_Turing">test di Turing</a>.</p>
</section>
<section id="un-interpreter-per-il-led">
<span id="ledapplintepreternoctx"></span><h3>Un interpreter per il Led<a class="headerlink" href="#un-interpreter-per-il-led" title="Permalink to this headline">¶</a></h3>
<p>L’intepreter per il Led riconosce frasi generate da <code class="docutils literal notranslate"><span class="pre">LEDMSG</span></code> (si veda <a class="reference internal" href="#linguaggiocomando">LinguaggioComando</a>)  e le esegue
invocando il dispositivo rappresentato da un POJO di interfaccia <a class="reference internal" href="RadarSystemProdottiAnalisi.html#iled"><span class="std std-ref">ILed</span></a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LedApplIntepreter</span> <span class="kd">implements</span> <span class="n">IApplIntepreter</span>  <span class="p">{</span>
<span class="n">ILed</span> <span class="n">led</span><span class="p">;</span>
  <span class="kd">public</span> <span class="nf">LedApplIntepreter</span><span class="p">(</span>  <span class="n">ILed</span> <span class="n">led</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="na">led</span> <span class="o">=</span> <span class="n">led</span><span class="p">;</span> <span class="p">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">elaborate</span><span class="p">(</span> <span class="n">String</span> <span class="n">message</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Analizza message e invoca il led, restituendo un risultato o una risposta</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">message</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;getState&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">led</span><span class="p">.</span><span class="na">getState</span><span class="p">()</span> <span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">message</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;on&quot;</span><span class="p">))</span> <span class="n">led</span><span class="p">.</span><span class="na">turnOn</span><span class="p">();</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">message</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;off&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="n">led</span><span class="p">.</span><span class="na">turnOff</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">message</span><span class="o">+</span><span class="s">&quot;_done&quot;</span><span class="p">;</span>
  <span class="p">}</span>
</pre></div>
</div>
</section>
<section id="un-interpreter-per-il-sonar">
<span id="sonarapplintepreternoctx"></span><h3>Un interpreter per il Sonar<a class="headerlink" href="#un-interpreter-per-il-sonar" title="Permalink to this headline">¶</a></h3>
<p>L’intepreter per il Sonar riconosce frasi generate da <code class="docutils literal notranslate"><span class="pre">SONARMSG</span></code> (si veda <a class="reference internal" href="#linguaggiocomando">LinguaggioComando</a>) e le esegue invocando
il dispositivo rappresentato da un POJO di interfaccia <a class="reference internal" href="RadarSystemProdottiAnalisi.html#isonar"><span class="std std-ref">ISonar</span></a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SonarApplIntepreter</span> <span class="kd">implements</span> <span class="n">IApplIntepreter</span><span class="p">{</span>
<span class="kd">private</span>       <span class="n">ISonar</span> <span class="n">sonar</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">SonarApplIntepreter</span><span class="p">(</span><span class="n">ISonar</span> <span class="n">sonar</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="na">sonar</span> <span class="o">=</span> <span class="n">sonar</span><span class="p">;</span> <span class="p">}</span>
  <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">elaborate</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Analizza message e invoca il Sonar restituendo un risultato o una risposta</span>
    <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="componenti-per-il-sonar">
<h2>Componenti per il Sonar<a class="headerlink" href="#componenti-per-il-sonar" title="Permalink to this headline">¶</a></h2>
<a class="reference internal image-reference" href="_images/EnablerProxySonar.PNG"><img alt="_images/EnablerProxySonar.PNG" class="align-center" src="_images/EnablerProxySonar.PNG" style="width: 60%;" /></a>
<section id="enabler-per-il-sonar">
<h3>Enabler per il Sonar<a class="headerlink" href="#enabler-per-il-sonar" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/EnablerAsServerSonar.PNG"><img alt="_images/EnablerAsServerSonar.PNG" class="align-center" src="_images/EnablerAsServerSonar.PNG" style="width: 80%;" /></a>
</td>
<td><p>L’<em>enabler tipo server</em> per il Sonar è un <code class="docutils literal notranslate"><span class="pre">EnablerAsServer</span></code> connesso un gestore
applicativo <code class="docutils literal notranslate"><span class="pre">SonarApplHandler</span></code> che si avvale di <a class="reference internal" href="#sonarapplintepreternoctx"><span class="std std-ref">Un interpreter per il Sonar</span></a> per
trasformare messaggi in chiamate di metodi:</p></td>
</tr>
</tbody>
</table>
</section>
<section id="sonarapplhandler">
<span id="sonarapplhandlernocontext"></span><h3>SonarApplHandler<a class="headerlink" href="#sonarapplhandler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SonarApplHandler</span> <span class="kd">extends</span> <span class="n">ApplMsgHandler</span>  <span class="p">{</span>
<span class="kd">private</span> <span class="n">IApplIntepreter</span> <span class="n">sonarLogic</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">SonarApplHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">ISonar</span> <span class="n">sonar</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="n">sonarLogic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SonarApplIntepreter</span><span class="p">(</span><span class="n">sonar</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">elaborate</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">Interaction2021</span> <span class="n">conn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">message</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;getDistance&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="n">message</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;isActive&quot;</span><span class="p">)</span>  <span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span><span class="k">else</span> <span class="n">sonarLogic</span><span class="p">.</span><span class="na">elaborate</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="proxy-per-il-sonar">
<span id="sonarproxyasclientnocontext"></span><h3>Proxy per il Sonar<a class="headerlink" href="#proxy-per-il-sonar" title="Permalink to this headline">¶</a></h3>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><a class="reference internal image-reference" href="_images/SonarProxyAsClient.PNG"><img alt="_images/SonarProxyAsClient.PNG" class="align-center" src="_images/SonarProxyAsClient.PNG" style="width: 70%;" /></a>
</td>
<td><p>Il ‘<em>proxy tipo client</em> per il Sonar è una specializzazione di  <a class="reference internal" href="RadarSystemSupporti.html#proxyasclient"><span class="std std-ref">ProxyAsClient</span></a> che implementa i
metodi di <code class="docutils literal notranslate"><span class="pre">ISonar</span></code> inviando comandi o richieste all’<em>enabler tipo server</em> sulla connessione
<a class="reference internal" href="RadarSystemAnalisi.html#interaction2021"><span class="std std-ref">Interaction2021</span></a>:</p></td>
</tr>
</tbody>
</table>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SonarProxyAsClient</span> <span class="kd">extends</span> <span class="n">ProxyAsClient</span> <span class="kd">implements</span> <span class="n">ISonar</span><span class="p">{</span>
  <span class="kd">public</span> <span class="nf">SonarProxyAsClient</span><span class="p">(</span>
       <span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">String</span> <span class="n">host</span><span class="p">,</span> <span class="n">String</span> <span class="n">entry</span><span class="p">,</span> <span class="n">ProtocolType</span> <span class="n">protocol</span> <span class="p">)</span> <span class="p">{</span>
  <span class="kd">super</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span>  <span class="n">host</span><span class="p">,</span>  <span class="n">entry</span><span class="p">,</span> <span class="n">protocol</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">activate</span><span class="p">()</span> <span class="p">{</span> <span class="n">sendCommandOnConnection</span><span class="p">(</span><span class="s">&quot;activate&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deactivate</span><span class="p">()</span> <span class="p">{</span> <span class="n">sendCommandOnConnection</span><span class="p">(</span><span class="s">&quot;deactivate&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">IDistance</span> <span class="nf">getDistance</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">sendRequestOnConnection</span><span class="p">(</span><span class="s">&quot;getDistance&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Distance</span><span class="p">(</span> <span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span> <span class="p">);</span>
  <span class="p">}</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isActive</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">sendRequestOnConnection</span><span class="p">(</span><span class="s">&quot;isActive&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">answer</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span> <span class="s">&quot;true&quot;</span> <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="componenti-per-il-led">
<h2>Componenti per il Led<a class="headerlink" href="#componenti-per-il-led" title="Permalink to this headline">¶</a></h2>
<p>Il caso del Led è simile al caso del Sonar, sia per quanto riguarda l’enabler, sia per quanto riguarda il proxy.</p>
<a class="reference internal image-reference" href="_images/EnablerProxyLed.PNG"><img alt="_images/EnablerProxyLed.PNG" class="align-center" src="_images/EnablerProxyLed.PNG" style="width: 60%;" /></a>
<p>Riportiamo qui solo la struttura dell’handler che realizza la logica applicativa.</p>
<section id="ledapplhandler">
<span id="ledapplhandlernocontext"></span><h3>LedApplHandler<a class="headerlink" href="#ledapplhandler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-Java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LedApplHandler</span> <span class="kd">extends</span> <span class="n">ApplMsgHandler</span>   <span class="p">{</span>
<span class="kd">private</span> <span class="n">IApplIntepreter</span> <span class="n">ledLogic</span><span class="p">;</span>

  <span class="kd">public</span> <span class="nf">LedApplHandler</span><span class="p">(</span><span class="n">String</span> <span class="n">name</span><span class="p">,</span> <span class="n">ILed</span> <span class="n">led</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
    <span class="n">ledLogic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LedApplIntepreter</span><span class="p">(</span><span class="n">led</span><span class="p">)</span> <span class="p">;</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">elaborate</span><span class="p">(</span><span class="n">String</span> <span class="n">message</span><span class="p">,</span> <span class="n">Interaction2021</span> <span class="n">conn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">message</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;getState&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="n">sendMsgToClient</span><span class="p">(</span> <span class="n">ledLogic</span><span class="p">.</span><span class="na">elaborate</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="n">conn</span> <span class="p">);</span>
    <span class="k">else</span> <span class="n">ledLogic</span><span class="p">.</span><span class="na">elaborate</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="testing-degli-enabler">
<span id="testingenablers"></span><h2>Testing degli enabler<a class="headerlink" href="#testing-degli-enabler" title="Permalink to this headline">¶</a></h2>
<p>La procedura si setup (configurazione) del testing crea gli elementi della architettura di figura:</p>
<a class="reference internal image-reference" href="_images/TestEnablers.PNG"><img alt="_images/TestEnablers.PNG" class="align-center" src="_images/TestEnablers.PNG" style="width: 50%;" /></a>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestEnablersTcp</span> <span class="p">{</span>
<span class="nd">@Before</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">withContext</span><span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">simulation</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">ledGui</span>     <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">ledPort</span>    <span class="o">=</span> <span class="mi">8015</span><span class="p">;</span>
  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">sonarPort</span>  <span class="o">=</span> <span class="mi">8011</span><span class="p">;</span>
  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">sonarDelay</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">testing</span>    <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">tracing</span>    <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

  <span class="c1">//I devices</span>
  <span class="n">sonar</span>       <span class="o">=</span> <span class="n">DeviceFactory</span><span class="p">.</span><span class="na">createSonar</span><span class="p">();</span>
  <span class="n">led</span>     <span class="o">=</span> <span class="n">DeviceFactory</span><span class="p">.</span><span class="na">createLed</span><span class="p">();</span>

  <span class="c1">//I server</span>
  <span class="n">sonarServer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EnablerAsServer</span><span class="p">(</span><span class="s">&quot;sonarSrv&quot;</span><span class="p">,</span><span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">sonarPort</span><span class="p">,</span>
              <span class="n">protocol</span><span class="p">,</span> <span class="k">new</span> <span class="n">SonarApplHandler</span><span class="p">(</span><span class="s">&quot;sonarH&quot;</span><span class="p">,</span> <span class="n">sonar</span><span class="p">)</span> <span class="p">);</span>
  <span class="n">ledServer</span>   <span class="o">=</span> <span class="k">new</span> <span class="n">EnablerAsServer</span><span class="p">(</span><span class="s">&quot;ledSrv&quot;</span><span class="p">,</span>  <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">ledPort</span><span class="p">,</span>
              <span class="n">protocol</span><span class="p">,</span> <span class="k">new</span> <span class="n">LedApplHandler</span><span class="p">(</span><span class="s">&quot;ledH&quot;</span><span class="p">,</span> <span class="n">led</span><span class="p">)</span>  <span class="p">);</span>

  <span class="c1">//I proxy</span>
  <span class="n">sonarPxy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SonarProxyAsClient</span><span class="p">(</span> <span class="s">&quot;sonarPxy&quot;</span><span class="p">,</span> <span class="s">&quot;localhost&quot;</span><span class="p">,</span>
            <span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">sonarPort</span><span class="p">,</span> <span class="n">protocol</span> <span class="p">);</span>
  <span class="n">ledPxy</span>   <span class="o">=</span> <span class="k">new</span> <span class="n">LedProxyAsClient</span><span class="p">(</span> <span class="s">&quot;ledPxy&quot;</span><span class="p">,</span>   <span class="s">&quot;localhost&quot;</span><span class="p">,</span>
           <span class="s">&quot;&quot;</span><span class="o">+</span><span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">ledPort</span><span class="p">,</span>   <span class="n">protocol</span> <span class="p">);</span>
<span class="p">}</span>

<span class="nd">@After</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">down</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">ledServer</span><span class="p">.</span><span class="na">stop</span><span class="p">();</span>
  <span class="n">sonarServer</span><span class="p">.</span><span class="na">stop</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il test simula il comportamento del Controller, senza RadarDisplay:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testEnablers</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">sonarServer</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
        <span class="n">ledServer</span><span class="p">.</span><span class="na">start</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot; ==================== testEnablers &quot;</span>  <span class="p">);</span>

        <span class="c1">//Simulo il Controller</span>
        <span class="n">Utils</span><span class="p">.</span><span class="na">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

        <span class="c1">//Attivo il sonar</span>
        <span class="n">sonarPxy</span><span class="p">.</span><span class="na">activate</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;testEnablers &quot;</span> <span class="o">+</span> <span class="n">sonarPxy</span><span class="p">.</span><span class="na">isActive</span><span class="p">());</span>

        <span class="k">while</span><span class="p">(</span> <span class="n">sonarPxy</span><span class="p">.</span><span class="na">isActive</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="n">sonarPxy</span><span class="p">.</span><span class="na">getDistance</span><span class="p">().</span><span class="na">getVal</span><span class="p">();</span>
                <span class="n">ColorsOut</span><span class="p">.</span><span class="na">out</span><span class="p">(</span><span class="s">&quot;testEnablers getVal=&quot;</span><span class="o">+</span><span class="n">v</span><span class="p">,</span> <span class="n">ColorsOut</span><span class="p">.</span><span class="na">GREEN</span><span class="p">);</span>
                <span class="c1">//Utils.delay(500);</span>
                <span class="k">if</span><span class="p">(</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">RadarSystemConfig</span><span class="p">.</span><span class="na">DLIMIT</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="n">ledPxy</span><span class="p">.</span><span class="na">turnOn</span><span class="p">();</span>
                        <span class="kt">boolean</span> <span class="n">ledState</span> <span class="o">=</span> <span class="n">ledPxy</span><span class="p">.</span><span class="na">getState</span><span class="p">();</span>
                        <span class="n">assertTrue</span><span class="p">(</span> <span class="n">ledState</span> <span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                        <span class="n">ledPxy</span><span class="p">.</span><span class="na">turnOff</span><span class="p">();</span>
                        <span class="kt">boolean</span> <span class="n">ledState</span> <span class="o">=</span> <span class="n">ledPxy</span><span class="p">.</span><span class="na">getState</span><span class="p">();</span>
                        <span class="n">assertTrue</span><span class="p">(</span> <span class="o">!</span> <span class="n">ledState</span> <span class="p">);</span>
                <span class="p">}</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="da-pojo-a-gestori-di-messaggi">
<h2>Da POJO a gestori di messaggi<a class="headerlink" href="#da-pojo-a-gestori-di-messaggi" title="Permalink to this headline">¶</a></h2>
<p>Al termine di questa fase dello sviluppo, poniamo in evidenza alcuni punti, che potrebbero
emergere al termine di una SPRINT-review:</p>
<ul class="simple">
<li><p>i nuovi componenti-base di livello applicativo non sono più POJO, ma sono
gestori di messaggi, come ad esempio <a class="reference internal" href="#sonarapplhandlernocontext"><span class="std std-ref">SonarApplHandler</span></a>  e <a class="reference internal" href="#ledapplhandlernocontext"><span class="std std-ref">LedApplHandler</span></a>;</p></li>
<li><p>i POJO originali (come <a class="reference internal" href="RadarSystemProgetto.html#sonar"><span class="std std-ref">Sonar</span></a> e <a class="reference internal" href="RadarSystemProgetto.html#led"><span class="std std-ref">Led</span></a>) sono stati incapsulati
negli handler che specializzano la  classe <a class="reference internal" href="RadarSystemSupporti.html#applmsghandler"><span class="std std-ref">ApplMsgHandler</span></a>;</p></li>
<li><p>i gestori di messaggi lavorano all’interno di componenti (<a class="reference internal" href="#enabler"><span class="std std-ref">Enabler</span></a>)
che forniscono una infrastruttura per le comunicazioni via rete. Il codice
che realizza gli enabler e i proxy può essere riutilizzato in altre applicazioni;</p></li>
<li><p>l’attenzione dell’<span class="blue">Application Designer</span> si concentra sulla definizione del metodo
<code class="docutils literal notranslate"><span class="pre">elaborate</span></code> di componenti-gestori di tipo <a class="reference internal" href="RadarSystemSupporti.html#applmsghandler"><span class="std std-ref">ApplMsgHandler</span></a>
che ricevono dalla
infrastruttura-enabler un oggetto (di tipo  <a class="reference internal" href="RadarSystemAnalisi.html#interaction2021"><span class="std std-ref">Interaction2021</span></a>)
che abilita alle interazioni via rete;</p></li>
<li><p>i messaggi gestiti dagli handler sono  <code class="docutils literal notranslate"><span class="pre">String</span></code> di struttura non meglio specificata;</p></li>
</ul>
<p>Il <a class="reference internal" href="#testingenablers"><span class="std std-ref">testing degli enablers</span></a>  ha già mostrato come sia possibile affrontare
il punto 4 del nostro <a class="reference internal" href="RadarSystemProdottiAnalisi.html#pianolavoro"><span class="std std-ref">piano di lavoro</span></a></p>
<ul class="simple">
<li><p>assemblaggio dei componenti  per formare il sistema distribuito.</p></li>
</ul>
<p>Tuttavia emerge un punto critico:</p>
<p><span class="remark">introdurre un serverTCP per ogni componente potrebbe essere, in generale, troppo costoso</span></p>
<p>Un serverTCP richiede infatti la creazione di un nuovo Thread. Anche se il costo di questa
operazione potrebbe essere (notevolmente) ridotto sostituendo il Thread Java con la
coroutine Kotlin, il team di sviluppo osserva che lo si può evitare con una modifica
non troppo complessa.</p>
<p>La modifica parte da questa domanda: è possibile che i gestori applicativi di messaggi (gli handler)
possano essere dotati di capacità di comunicazione avvalendosi di un <em>singolo serverTCP</em>
per nodo computazionale?</p>
<p>La prossima sezione sarà dedicata alla realizzazione di questa idea, che ci farà fare
un ulteriore passo in avanti nella transizione dal paradigma ad oggetti al paradigma
a messaggi.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo-unibo.gif" alt="Logo"/>
    
    <h1 class="logo logo-name">iss22</h1>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduzione.html">Costruire software</a></li>
<li class="toctree-l1"><a class="reference internal" href="Indicazioni.html">Indicazioni</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystem.html">RadarSystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemAnalisi.html">Analisi del problema</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemProdottiAnalisi.html">Prodotti della analisi</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemProgetto.html">Progettazione e sviluppo</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemSupporti.html">Supporti per comunicazioni</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Abilitatori di comunicazione</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#enabler-tipo-server">Enabler tipo-server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interpreti">Interpreti</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#linguaggio-di-comando">Linguaggio di comando</a></li>
<li class="toctree-l3"><a class="reference internal" href="#un-interpreter-per-il-led">Un interpreter per il Led</a></li>
<li class="toctree-l3"><a class="reference internal" href="#un-interpreter-per-il-sonar">Un interpreter per il Sonar</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#componenti-per-il-sonar">Componenti per il Sonar</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#enabler-per-il-sonar">Enabler per il Sonar</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sonarapplhandler">SonarApplHandler</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proxy-per-il-sonar">Proxy per il Sonar</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#componenti-per-il-led">Componenti per il Led</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#ledapplhandler">LedApplHandler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#testing-degli-enabler">Testing degli enabler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#da-pojo-a-gestori-di-messaggi">Da POJO a gestori di messaggi</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ContestiContenitori.html">Contesti-contenitori</a></li>
<li class="toctree-l1"><a class="reference internal" href="VersoUnFramework.html">Verso un framework per la interazione distribuita</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemTcp.html">Il RadarSystem con TCP</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemMqtt.html">Il RadarSystem con MQTT</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemCoap.html">Il RadarSystem con CoAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarGuiCoap.html">RadarGuiCoap</a></li>
<li class="toctree-l1"><a class="reference internal" href="RadarSystemDeploy.html">RadarSystem deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="ApproccioTopDown.html">Un approccio top-down al processo</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="RadarSystemSupporti.html" title="previous chapter">Supporti per comunicazioni</a></li>
      <li>Next: <a href="ContestiContenitori.html" title="next chapter">Contesti-contenitori</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Antonio Natali.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/Enablers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>