	<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>ActorsWithKotlinSupport</title></head>
    
<body>
<div id="top">
<h1>LabIss2021 | support for Actors based on Kotlin<font size="5"></font> </h1>
</div>  

<div class="body"> 
<h2>Introduction</h2>
<ol>
<li><a href="../app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code"><ks>ActorBasicKotlin.kt</ks></a> 
with <a href="../app/src/main/kotlin/it/unibo/actor0/ActorBasicContextKb.kt" target="code"><ks>ActorBasicContextKb.kt</ks></a>
and  <a href="../app/src/main/kotlin/it/unibo/actor0/ActorContextTcpServer.kt" target="code"><ks>ActorContextTcpServer.kt</ks></a>
</li>
<li></li>
<li></li>
<li></li>
<li></li>
</ol>



<h2 id="uniboActor">A new (abstract) component</h2>
The abstract class 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
defines the properties of new abstraction that (from now on) can be used as the father of all our actors.

 

<center><table style="width:95%"> 
<tbody>	
<tr>
<td style="width:45%">
<h3>The uniboActor (outside view)</h3>
<br/><br/>
<center><img src="./img/symActor.png" alt="symActor" width="15%"></center>
<br/><br/>
An <tt>uniboActor</tt> is a specializaztion of the abstract class 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
defined in the project 
 <a href="../../it.unibo.kotlinSupports" target="code">it.unibo.kotlinSupports</a>
and provides the following features:
<ul> 
<li>owns a <ks>name</ks> that should be <k>unique</k> in the application system</li>
<li>implements the interface
 <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/interaction/IUniboActor.kt" target="code">IUniboActor.kt</a>
 that inherits from <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/interaction/IssActorObservable.kt" target="code">IssActorObservable.kt</a> 
 </li>
 <li>is <k>observable</k> by other <tt>uniboActors</tt> 
 </li>
<li>is able to handle messages expressed as String that are the representation of the type 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code"><em>ApplMessage.kt</em></a>
</li>
<li>requires a specialized version of the abstract operation
<pre>
 abstract suspend protected  fun <ks>handleInput</ks>(msg : <ks>ApplMessage</ks>)
</pre>
</li>
 

</ul>
</td>
<td>
<h3>The uniboActor (internal view)</h3>
<center><img src="./img/ActorBasicKotlin.png" alt="ActorBasicKotlin" width="70%"  ></center>

<br/>
The  class <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
embeds a kotlin acor (referred by the var <ks>kactor</ks>). It is  able to perform the following actions: <br/><br/>
<m>
<ul>
<li><i>send a message</i> to itself (<ks>send,  sendToYourself</ks>) </li>
<li><i>send a message</i> (<ks>forward, sendToActor</ks>) to another <tt>uniboActor</tt> kown by reference</li>
<li><i>delay</i>  (<ks>dosleep</ks>) the execution for a given time  </li>
<li><i>end its activity</i> (<ks>terminate</ks>) </li>
<li><i>wait for a user command</i> (<ks>waitUser</ks>): useful during debugging</li>
</ul>

<div class="remark">
Moreover it defines a  data structure that can be used to store a message <ks>M</ks>, when the actor is in a state
whose transition set does not include <ks>M</ks>:
<pre>
protected val msgQueueStore = mutableListOf&lt;ApplMessage>()
</pre>
</div>
</m>
 
 
See <a href="../../it.unibo.kotlinSupports/userDocs/ActorBasicKotlin.html" target="code">LabIss2021 | ActorBasicKotlin.html</a>
in project <a href="../../it.unibo.kotlinSupports" target="code">it.unibo.kotlinSupports</a>.<br/>
 </td>
</tr>
 
<tr> 
<td>
 
</td>
<td>
</td>
</tr>


</tbody>	
</table></center>

<h2>Support for robots</h2>

<table style="width:98%">
<tbody>	

<tr>
<td style="width:50%" ><h3 id="IssWsHttpKotlinSupport">IssWsHttpKotlinSupport</h3>
The class
  <a href="../app/src/main/kotlin/it/unibo/supports/IssWsHttpKotlinSupport.kt" target="code">IssWsHttpKotlinSupport.kt</a>
  provides a singleton (for each ip address) that defines utility operations to connect/disconnect (to the given ip address) 
  via HTTP or a websocket, using the library  <a href="https://square.github.io/okhttp/" target="web">okhttp3</a>.
  <br/> <br/>
  This utility:
  <ul>
  <li>implements the interface <a href="../app/src/main/kotlin/it/unibo/interaction/IssCommSupport.kt" target="code">IssCommSupport.kt</a>  </li>
  <li>implements the operations defined in the interface
  <a href="../app/src/main/kotlin/it/unibo/interaction/IssOperations.kt" target="code">IssOperations.kt</a></li>
  <li>works as an observer of the ws-socket</li>
  <li>is, in its turn,  observable by components that implement the interface
   <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/interaction/IUniboActor.kt" target="code">IUniboActor.kt</a></li>
  </ul>
 

<br/><br/>
  
</td>
<td><center><img src="./img/IssWsHttpKotlinSupport.png" alt="IssWsHttpKotlinSupport" width="80%"  ></center>
Usage example:
<pre>
IssWsHttpKotlinSupport.getConnectionWs(scope,"localhost:8091")
</pre>

</td>
</tr>
<tr>
<td style="width:50%">
 <h3>AbstractRobotActor</h3>
The  class <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/AbstractRobotActor.kt" target="code">AbstractRobotActor.kt</a>
extends <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a> and
provides a <tt>uniboActor</tt> that:<br/><br/>
<m>
<ul>
<li>includes the <a href="../app/src/main/kotlin/it/unibo/supports/IssWsHttpKotlinSupport.kt" target="code">IssWsHttpKotlinSupport.kt</a>
for the virtual robot working in the WEnv</li>
<li>
accepts messages of type <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code"><em>ApplMessage.kt</em></a>
with payload given by Strings that represents JSON objects, as  defined  in the utility class
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/ApplMsgs.kt" target="code"><em>ApplMsgs.kt</em></a>.<br/>
</li>

<li>
implements the operation <ks>handleInput</ks> by delegating to an abstract operation <ks>msgDriven</ks> the handling of the JSON-payload:  
<pre>
 override suspend fun <ks>handleInput</ks>(msg: ApplMessage) {
   msgDriven( JSONObject( msg.msgContent ) )  
 }

 protected abstract fun <ks>msgDriven</ks>(infoJson: JSONObject)
 </pre>
</li>

</m>


<center><img src="./img/AbstractRobot.png" alt="AbstractRobot" width="100%"  ></center>
 

</td>
<td>
  <h3>Basic <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/ApplMsgs.kt" target="code"><em>ApplMsgs.kt</em></a></h3>
  Let us report here some of the JSON strings that represent basic robot-moves:
  <pre><m>
    val <ks>forwardMsg</ks> = "{\"robotmove\":\"moveForward\", \"time\": 350}"
    val <ks>backwardMsg</ks> = "{\"robotmove\":\"moveBackward\", \"time\": 350}"
    val <ks>turnLeftMsg</ks> = "{\"robotmove\":\"turnLeft\", \"time\": 300}"
    val <ks>turnRightMsg</ks> = "{\"robotmove\":\"turnRight\", \"time\": 300}"
    val <ks>haltMsg</ks> = "{\"robotmove\":\"alarm\", \"time\": 20}"
	... 
    val endMoveId = "endmove"
    val <ks>endMoveMsg</ks> = "{\"ID\":\"ENDMOVE\" }".replace("ID", endMoveId)
	...
    val stepId = "step"
    val <ks>stepMsg</ks> = "{\"ID\":\"TIME\" }".replace("ID", stepId)
    val stepDoneId = "stepDone"
    val <ks>stepDoneMsg</ks> = "{\"ID\":\"ok\" }".replace("ID", stepDoneId)
    val stepFailId = "stepFail"
    val <ks>stepFailMsg</ks> = "{\"ID\":\"TIME\" }".replace("ID", stepFailId)
	...</m></pre>
</td>
</tr>

<tr>
<td style="width:50%">
 <h3>BasicStepRobotActor</h3>
The  class <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>
extends <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">AbstractRobotActor.kt</a>
with the aim of moving the robot.

<br/><br/>
This actor 
<ul>
<li>has the default name <k>stepRobot</k></li>
<li>is related to a <k>onwer</k> actor thet must be given at cretion time</li>
<li>is able to perform both <tt>basic-moves</tt> and <tt>step-moves</tt>
<m>A <k>step-move</k> is a forward-move with a time properly set, so that
the distance traveled by the robot is equal to the diameter of the circle in which it is supposed to be inscribed.
</m>
</li>
<li>gives a <k>endMoveMsg</k> 
(see <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/ApplMsgs.kt" target="code"><em>ApplMsgs.kt</em></a>) 
as answer to a <tt>basic-move</tt>
</li>
<li>gives as (payload) answer to a <tt>step-move</tt> 
	<ul>
	<li><k>stepDoneMsg</k>: if the step is done with success</li>
	<li><k>stepFailMsg</k>: if the step cannot be completed</li>
	</ul>
</li>

</ul>
</td>
<td>
<center><img src="./img/BasicStepRobotActor.png" alt="BasicStepRobotActor" width="100%"  ></center>
 
<div class="remark">
The <a href="../app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>
avoids the interference among overlapping commands. In fact, it exploits the <k>msgQueueStore</k>
to store a robot-move command while another <tt>basic-move</tt> or <tt>step-move</tt> is still in execution.
The stored move is executed when the move in execution ends.
</div>

</td>
</tr>

<tr> 
<td><h3>Example: BasicStepRobotCaller</h3>
  The  class <a href="../../it.unibo.cautiousExplorer/app/src/main/kotlin/demoWithRobot/BasicStepRobotActorCaller.ktt" target="code">BasicStepRobotActorCaller.kt</a>
extends <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
with the aim of sending some commands to the 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>
to test its behavior.
 <hr/>
 The class <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/ApplMsgs.kt" target="code"><em>ApplMsgs.</em></a> 
defines operations that return a <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code"><em>ApplMessage.kt</em></a>
that can be sent to a 
<a href="../app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>.
More specifically:
<hr/>

<ul>
<li><ks>stepRobot_step()</ks> :  for a <tt>step-move</tt>
 
</li>
<li><ks>stepRobot_<k>MOVE</k>()</ks> : for a <tt>basic-move</tt> <k>MOVE = <tt>w | s | l | r | h</tt></k></li>
</ul>

<pre>
<m>val robot = BasicStepRobotActor("stepRobot", ownerActor=this, scope, "localhost")</m>

	robot.registerActor(this)
	robot.send(ApplMsgs.stepRobot_l("main" ))
	robot.send(ApplMsgs.stepRobot_r("main" ))

</pre>
</td>

<td>
The code is in the project <a href="../../it.unibo.cautiousExplorer" target="code">it.unibo.cautiousExplorer</a>.
<br/><br/>
<center><img src="./img/BasicStepRobotActorCaller.png" alt="BasicStepRobotActorCaller" width="80%"  ></center>
 
Note that the robot perform the moves, but the ouput shows the message:
<pre>
<k>stepRobot BasicStepRobotActor |  move already running: store the request</k>
</pre>
In fact, the caller sends the move-commands without any delay between them.
</td>
</tr>


<tr> 
<td>

Todo: BoundaryWalk
<hr/>
use the  <a href="../app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>
to define an actor that solves the problems introduced in
<a href="../../it.unibo.boundaryWalk/userdocs/BoundaryWalk.html" target="lab">LabIss2021 | BoundaryWalk</a>
and  in <a href="../../it.unibo.virtualrobotclient/userDocs/resumableBoundaryWalker.html" target="web">Lab ISS | the project resumableBoundaryWalker</a>
</td>
<td>
<div class="remark">
Next: build a <k>RobotService</k>
<hr/>
See <a href="RobotService.html" target="web">LabIss2021 | a RobotService</a>
</div> 
</td>
</tr>
 </tbody>
</table>

<h2 id="deploy">Deployment</h2>

<ol>

<li><h3>Create the library</h3>
<pre>
gradlew distJar

<kc>Creates the file <ks>app-2.0.jar</ks>, renamed in <k>IssActorKotlinRobotSupport-2.0.jar</k></kc></pre>
</li>

<li><h3>Copy the library</h3>
<pre>
Copy from <ks>it.unibo.kotlinSupports/app/build/libs/IssActorKotlinRobotSupport-2.0.jar</ks> into 
<k>/unibolibs/IssActorKotlinRobotSupport-2.0.jar</k></kc></pre>
</li>

 
<ol>


   <!--
<ol>
<li></li>
<li></li>
<li></li>
</ol>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
 

</td>
<td>
</td>
</tr>
 </tbody>
</table>
-->
	      	
<br/><br/> 	
</div>  

<div style="background-color:rgba(86, 56, 253, 0.9); width:100%;text-align:center;font-size:small;color:white">
By AN Unibo-DISI  
</div>
</body>
</html>