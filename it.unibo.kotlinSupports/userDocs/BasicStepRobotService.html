	<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>KotlinActorSupport</title></head>
    
<body>
<div id="top">
<h1>LabIss2021 | wshttp support with ActorBasicKotlin observers <font size="5"></font> </h1>
</div>  

<div class="body"> 
<h2>Introduction</h2>
<ol>
<li><a href="../app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code"><ks>ActorBasicKotlin.kt</ks></a> 
with <a href="../app/src/main/kotlin/it/unibo/actor0/ActorBasicContextKb.kt" target="code"><ks>ActorBasicContextKb.kt</ks></a>
and  <a href="../app/src/main/kotlin/it/unibo/actor0/ActorContextTcpServer.kt" target="code"><ks>ActorContextTcpServer.kt</ks></a>
</li>
<li></li>
<li></li>
<li></li>
<li></li>
</ol>



<h2 id="uniboActor">A new (abstract) component</h2>
The abstract class 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
defines the properties of new abstraction that (from now on) can be used as the father of all our actors.

 

<center><table style="width:95%"> 
<tbody>	
<tr>
<td style="width:45%">
<h3>The uniboActor (outside view)</h3>
<br/><br/>
<center><img src="./img/symActor.png" alt="symActor" width="15%"></center>
<br/><br/>
An <tt>uniboActor</tt> is a specializaztion of the abstract class 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
defined in the project 
 <a href="../../it.unibo.kotlinSupports" target="code">it.unibo.kotlinSupports</a>
and provides the following features:
<ul> 
<li>owns a <ks>name</ks> that should be <k>unique</k> in the application system</li>
<li>implements the interface
 <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/interaction/IUniboActor.kt" target="code">IUniboActor.kt</a>
 that inherits from <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/interaction/IssActorObservable.kt" target="code">IssActorObservable.kt</a> 
 </li>
 <li>is <k>observable</k> by other <tt>uniboActors</tt> 
 </li>
<li>is able to handle messages expressed as String that are the representation of the type 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code"><em>ApplMessage.kt</em></a>
</li>
<li>requires a specialized version of the abstract operation
<pre>
 abstract suspend protected  fun <ks>handleInput</ks>(msg : <ks>ApplMessage</ks>)
</pre>
</li>
 

</ul>
</td>
<td>
<h3>The uniboActor (internal view)</h3>
<center><img src="./img/ActorBasicKotlin.png" alt="ActorBasicKotlin" width="70%"  ></center>

<br/>
The  class <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
embeds a kotlin acor (referred by the var <ks>kactor</ks>). It is  able to perform the following actions: <br/><br/>
<m>
<ul>
<li><i>send a message</i> to itself (<ks>send,  sendToYourself</ks>) </li>
<li><i>send a message</i> (<ks>forward, sendToActor</ks>) to another <tt>uniboActor</tt> kown by reference</li>
<li><i>delay</i>  (<ks>dosleep</ks>) the execution for a given time  </li>
<li><i>end its activity</i> (<ks>terminate</ks>) </li>
<li><i>wait for a user command</i> (<ks>waitUser</ks>): useful during debugging</li>
</ul>

<div class="remark">
Moreover it defines a  data structure that can be used to store a message <ks>M</ks>, when the actor is in a state
whose transition set does not include <ks>M</ks>:
<pre>
protected val msgQueueStore = mutableListOf&lt;ApplMessage>()
</pre>
</div>
</m>
 
 
See <a href="../../it.unibo.kotlinSupports/userDocs/ActorBasicKotlin.html" target="code">LabIss2021 | ActorBasicKotlin.html</a>
in project <a href="../../it.unibo.kotlinSupports" target="code">it.unibo.kotlinSupports</a>.<br/>
 </td>
</tr>



<tr>
<td>
 <h3>AbstractRobotActor</h3>
The  class <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/AbstractRobotActor.kt" target="code">AbstractRobotActor.kt</a>
extends <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a> and
provides a <tt>uniboActor</tt> that:<br/><br/>

<m>
<ul>
<li>
accepts messages of type <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code"><em>ApplMessage.kt</em></a>
with payload given by Strings that represents JSON objects, as  defined  in the utility class
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/ApplMsgs.kt" target="code"><em>ApplMsgs.kt</em></a>.<br/>
</li>

<li>
implements the operation <ks>handleInput</ks> by delegating to an abstract operation <ks>msgDriven</ks> the handling of the JSON-payload:  
<pre>
 override suspend fun <ks>handleInput</ks>(msg: ApplMessage) {
   msgDriven( JSONObject( msg.msgContent ) )  
 }

 protected abstract fun <ks>msgDriven</ks>(infoJson: JSONObject)
 </pre>
</li>

</m>


</td>
<td>
  <h3>Basic <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/ApplMsgs.kt" target="code"><em>ApplMsgs.kt</em></a></h3>
  Let us report here some of the JSON strings that represent basic robot-moves:
  <pre><m>
    val <ks>forwardMsg</ks> = "{\"robotmove\":\"moveForward\", \"time\": 350}"
    val <ks>backwardMsg</ks> = "{\"robotmove\":\"moveBackward\", \"time\": 350}"
    val <ks>turnLeftMsg</ks> = "{\"robotmove\":\"turnLeft\", \"time\": 300}"
    val <ks>turnRightMsg</ks> = "{\"robotmove\":\"turnRight\", \"time\": 300}"
    val <ks>haltMsg</ks> = "{\"robotmove\":\"alarm\", \"time\": 20}"
	... 
    val endMoveId = "endmove"
    val <ks>endMoveMsg</ks> = "{\"ID\":\"ENDMOVE\" }".replace("ID", endMoveId)
	...
    val stepId = "step"
    val <ks>stepMsg</ks> = "{\"ID\":\"TIME\" }".replace("ID", stepId)
    val stepDoneId = "stepDone"
    val <ks>stepDoneMsg</ks> = "{\"ID\":\"ok\" }".replace("ID", stepDoneId)
    val stepFailId = "stepFail"
    val <ks>stepFailMsg</ks> = "{\"ID\":\"TIME\" }".replace("ID", stepFailId)
	...</m></pre>
</td>
</tr>



<tr> 
<td>
 
</td>
<td>
</td>
</tr>


</tbody>	
</table></center>


<h2 id="deploy">Deploy</h2>

<ul>
<li> <a href="../Dockerfile" target="code"><ks>Dockerfile</ks></a> </li>
<li> <a href="../virtualrobotandstepper.yaml" target="code"><ks>virtualrobotandstepper.yaml</ks></a> </li>
<li><h3>Build the image for local usage</h3>
<pre>
<kc>//Build the image of the steprobot service with wenvAddr=<k>localhost</k> at line 27 of <a href="../app/src/main/kotlin/it/unibo/actor0robot/MainStepRobotService.kt" target="code"><ks>MainStepRobotService.kt</ks></a>) ) </kc>
docker build -t steprobot:1.0 .  

<kc>//run the image to test</kc>
docker run -p 8010:8010 -ti --rm steprobot:1.0 <k>/bin/bash</k> <kc>//to use the console</kc>  
</pre>
</li>
<li><h3>Build the image for integrated usage</h3>
<pre>
<kc>//Build the image of the steprobot service with wenvAddr=<k>wenv</k> at line 27 of <a href="../app/src/main/kotlin/it/unibo/actor0robot/MainStepRobotService.kt" target="code"><ks>MainStepRobotService.kt</ks></a>) ) </kc>
docker build -t steprobot:1.0 .  

<kc>//Run the steprobot service together with the wenv</kc>
docker-compose -f virtualrobotandstepper.yaml up

</pre>
<h4>Run a demo</h4>
 <a href="../../it.unibo.cautiousExplorer/app/src/main/kotlin/actor0remote/MainStepRobotActorCaller.kt" target="code"><ks>MainStepRobotActorCaller.kt</ks></a>
 in project <i>it.unibo.cautiousExplorer</i>
 
</li>

<li><h3>Tag the image and register on  <a href="https://hub.docker.com/?ref=login" target="web">DockerHub</a></h3>
<pre>
<kc>Login in DockerHub (get the password from a private file)</kc>
 type docker_password.txt | docker login --username natbodocker --password-stdin
 
<kc>Tag the image</kc>
docker tag steprobot:1.0 natbodocker/steprobot:1.0

<kc>Register the image</kc>
docker push natbodocker/steprobot:1.0
</pre>

<h4>Change <a href="../virtualrobotandstepper.yaml" target="code"><ks>virtualrobotandstepper.yaml</ks></a> </h4>
<pre>
version: '3'
services:
  wenv:
    image: docker.io/natbodocker/virtualrobotdisi:2.0
    ##image: virtualrobotdisi:2.0
    ports:
      - 8090:8090
      - 8091:8091
  stepper:
    ##image: steprobot:1.0
	image: docker.io/natbodocker/steprobot:1.0
    ports:
      - 8010:8010
    depends_on:
      - wenv
</pre>
</li>
</ul>

<h2>Examples</h2>

<center><table style="width:95%">
<tbody>	

 
<tr>
<td style="width:50%">
 <h3>BasicStepRobotActor</h3>
The  class <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>
extends <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">AbstractRobotActor.kt</a>
with the aim of moving the robot.

<br/><br/>
This actor is able to perform both <tt>basic-moves</tt> and <tt>step-moves</tt>. <br/>
A <k>step-move</k> is a forward-move with a time properly set, so that
the distance traveled by the robot is equal to the diameter of the circle in which it is supposed to be inscribed.
<br/><br/>
While the (payload of the) answer to a <tt>basic-move</tt> is a <ks>endMoveMsg</ks>, the (payload of the) answer to a <tt>step-move</tt> is
(see <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/ApplMsgs.kt" target="code"><em>ApplMsgs.kt</em></a>)
<ul>
<li><ks>stepDoneMsg</ks>: if the step is done with success</li>
<li><ks>stepFailMsg</ks>: if the step cannot be completed</li>
</ul>

<div class="remark">
The <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>
avoids the interference among overlapping commands. In fact, it exploits the <k>msgQueueStore</k>
to store a robot-move command while another <tt>basic-move</tt> or <tt>step-move</tt> is still in execution.
The stored move is executed when the move in execution ends.
</div>

</td>
<td>
<center><img src="../../it.unibo.kotlinSupports/userDocs/img/BasicStepRobotActor.png" alt="BasicStepRobotActor" width="100%"  ></center>
 <br/><br/>
 <hr/>
 The class <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/ApplMsgs.kt" target="code"><em>ApplMsgs.</em></a> 
defines operations that return a <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code"><em>ApplMessage.kt</em></a>
that can be sent to a 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>.
More specifically:
<br/><br/> 

<ul>
<li><ks>stepRobot_step()</ks> :  for a <tt>step-move</tt>
 
</li>
<li><ks>stepRobot_<k>MOVE</k>()</ks> : for a <tt>basic-move</tt> <k>MOVE = <tt>w | s | l | r | h</tt></k></li>
</ul>

</td>
</tr>

<tr> 
<td><h3>BasicStepRobotCaller</h3>
  The  class <a href="../../it.unibo.cautiousExplorer/app/src/main/kotlin/demoWithRobot/BasicStepRobotCaller.kt" target="code">BasicStepRobotCaller.kt</a>
extends <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
with the aim of sending some commands to the 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>
to test its behavior.
<pre>
<m>val robot = BasicStepRobotActor("stepRobot", ownerActor=this, scope, "localhost")</m>

	robot.registerActor(this)
	robot.send(ApplMsgs.stepRobot_l("main" ))
	robot.send(ApplMsgs.stepRobot_r("main" ))

</pre>
</td>

<td>Note that the robot perform the moves, but the ouput shows the message:
<pre>
<k>stepRobot BasicStepRobotActor |  move already running: store the request</k>
</pre>
In fact, the caller sends the move-commands without any delay between them.
</td>
</tr>



<tr> 
<td><h3>PathExecutor</h3>

 The  class <a href="../../it.unibo.cautiousExplorer/app/src/main/kotlin/demoWithRobot/PathExecutor.kt" target="code">PathExecutor.kt</a>
extends <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>
with the aim of sending commands to the 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/BasicStepRobotActor.kt" target="code">BasicStepRobotActor.kt</a>,
so to moving the robot along a given path (e.g. <ks>"wwl"</ks>).
<br/><br/>
This <tt>uniboActor</tt> exploits the utility class
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/mapRoomKotlin/TripInfo.kt" target="code">TripInfo.kt</a>
to create a map as a a singleton object, managed by another utility class
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/mapRoomKotlin/mapUtil.kt" target="code">mapUtil.kt</a>
</td>
<td>
<center><img src="./img/pathExecutor.png" alt="pathExecutor" width="100%"  ></center>
 <br/><br/>
</td>
</tr>


</tbody>	
</table></center>


<h2>Towards a robot service</h2>
 <br/>
Let us report, as an example,  an actor written in Kotlin that sends commands to our
<a href="../../it.unibo.kotlinSupports/userDocs/RobotService.html" target="web">RobotService</a>:<br/><br/>

<center><table style="width:95%"> 
<tbody>	
<tr>
<td style="width:30%">
<h4>A Koltin actor at work</h3>
<a href="../app/src/main/kotlin/robotWithActors/robotActorTry.kt" target="code">robotActorTry.kt</a><br/><br/>
<m>An example of usage is in:
<a href="../app/src/main/kotlin/robotWithActors/MainRobotActorTry.kt" target="code">MainRobotActorTry.kt</a>
</m>
</td>
<td>
<center><img src="./img/robotActorTry.png" alt="robotActorTry" width="100%" height="60%"></center>


 </td>
</tr>
</tbody>	
</table></center>

<br/>

<h3>The KotlinActor <a href="../app/src/main/kotlin/robotWithActors/robotActorTry.kt" target="code">robotActorTry.kt</a> 
as <a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="web">Finite State Machine</a></a></h3>
The behavior of the <a href="../app/src/main/kotlin/robotWithActors/robotActorTry.kt" target="code">robotActorTry.kt</a> 
can be modelled as a a <em>message-driven</em>  
<a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="web">Finite State Machine</a>
where each <bc>state</bc> is mapped into a <em>function</em> whose body specifies the <bc>actions</bc> to be executed in that state.
<br/><br/>

<center><table style="width:95%">
<tbody>	
<tr>
<td style="width:40%">
<pre>
 while( <ks>state == "working"</ks> ){
   var <ks>msg = channel.receive()</ks>
   val msgJson = JSONObject(msg)
   var input   = msgJson.keys().next()
   when( input ){
    "<k>cmd</k>"       -> doCmd(msgJson.getString("cmd"))
    "<k>move</k>"      -> doMove(...)
    "<k>sonarName</k>" -> doSonar(msg)
    "<k>collision</k>" -> doCollision(msg)
    else -> println("NO HANDLE for $msg")
  }		
 }
</pre>

</td>
<td>
<center><img src="./img/robotActorFsm.png" alt="robotActorFsm" width="60%"  ></center><br/>
 </td>
</tr>
</tbody>	
</table></center>

In the version, the  KotlinActor <a href="../app/src/main/kotlin/robotWithActors/robotActorTry.kt" target="code">robotActorTry.kt</a> handles messages
in the form of JSON objects:
<m>
 <ul>
 <li><k>{"cmd":"<ks>init</ks>"}</k>: starts its job</li>
 <li><k>{"cmd":"<ks>end</ks>"}</k>: terminates its job</li>
  <li><k>{"collision" : "...", "move": "..."}</k>: 'reacts' to a <i>collision message</i> sent by the WEnv </li>
 <li><k>{"sonarName": "...", "distance": ..., "axis": "..." }</k>: 'reacts' to a message sent by the WEnv  when a <em>scene-sonar</em> detects the robot</li>
<li><k>{"robotmove":"<ks>MOVE</ks>", "time":T}</k>: sends a move-command to the robot. 
 </li>
</ul></m>
 
Since the <a href="../../it.unibo.kotlinSupports/userDocs/RobotService.html" target="web">RobotService</a> understand messages represented in
the form of <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code">ApplMessage.kt</a>,
the move-command must be written in the proper way. For example:
 <pre>
 msg(robotmove,dispatch,<ks>actortry</ks>,<em>stepRobot</em>,{"robotmove":"moveForward" , "time": 350},1)</pre>
 Note that now:
 <div class="remark">
the <b>sender</b> (that names itself as <ks>'actortry'</ks>) has no reference to the component that will handle its message.
Rather it only knowns that the name of such a <b>destination</b> component is <em>'stepRobot'</em>.<br/>
The <a href="../../it.unibo.kotlinSupports/userDocs/RobotService.html" target="web">RobotService</a> will receive the message
sent by the <a href="../app/src/main/kotlin/robotWithActors/robotActorTry.kt" target="code">robotActorTry.kt</a>
on the (TCP) port <ks>8010</ks> and will redirect it the component named 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/robotService/StepRobotActor.kt" target="code"><em>'stepRobot'</em></a>,
which is  a specialization of a generic
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code">ActorBasicKotlin.kt</a>.

 </div>
<!--
However, it is quite simple to introduce a version of the  KotlinActor 
(let us call it <a href="../app/src/main/kotlin/robotWithActors/robotActorTry.kt" target="code">robotActorTry.kt</a>)
that accepts messages in the form of 
<a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code">ApplMessage.kt</a> 
-->
<h3>The KotlinActor <a href="../app/src/main/kotlin/robotWithActors/InputReader.kt" target="code">InputReader.kt</a> </h3>

The KotlinActor <a href="../app/src/main/kotlin/robotWithActors/InputReader.kt" target="code">InputReader.kt</a>
handles the messages 
(strings that represent an <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code">ApplMessage.kt</a> ) 
sent by the <a href="../../it.unibo.kotlinSupports/userDocs/RobotService.html" target="web">RobotService</a>; for example
<pre>
msg(endmove,dispatch,stepRobot,ctxServer,<ks>{"collision" : "true" , "move": "moveForward"}</ks>,5)
msg(endmove,dispatch,stepRobot,ctxServer,<ks>{"endmove" : "false" , "move": "moveForward"}</ks>,6)
msg(supportInfo,dispatch,support,observer,<ks>{"sonarName":"sonar2" , "distance":7 , "axis":"x"}</ks>,0) }
</pre> 




The KotlinActor <a href="../app/src/main/kotlin/robotWithActors/InputReader.kt" target="code">InputReader</a> sends to the 
<a href="../app/src/main/kotlin/robotWithActors/robotActorTry.kt" target="code">robotActorTry</a>
<i>the content of each received message</i>
(a string in JSON form) to the <a href="../../it.unibo.kotlinSupports/app/src/main/kotlin/it/unibo/actor0/ApplMessage.kt" target="code">ApplMessage.kt</a>.
<br/><br/>
Thus, it works as a (remote) observer of the <a href="../../it.unibo.kotlinSupports/userDocs/RobotService.html" target="web">RobotService</a>
that updates <a href="../app/src/main/kotlin/robotWithActors/robotActorTry.kt" target="code">robotActorTry</a> as an 'observer'
of the <a href="../app/src/main/kotlin/robotWithActors/InputReader.kt" target="code">InputReader</a> itself.


<br/><br/>

<!--

<h3>An example</h3>
 
An example of using the <a href="../src/virtualRobotUsage/robotActor.kt" target="code">robotActor.kt</a> can be found in 
<a href="../src/virtualRobotUsage/robotActorUsage.kt" target="code">robotActorUsage.kt</a>.
In this example, we first introduce a set of application messages:
<pre>
val initMsg			= AppMsg.create(<k>"init"</k>,		"main","robotactor")		<kc>//content="none" by default</kc>
val moveForwardMsg	= AppMsg.create(<k>"move"</k>,	"main","robotactor",		<k>"w"</k>,<k>AppMsgType.dispatch</k>) 
val haltRobotMsg		= AppMsg.create(<k>"move"</k>,	"main","robotactor",		<k>"h"</k>) 
</pre>

Afterwards, we define a method <tt>forward</tt> to send messages of type <bc>dispatch</bc> (<tt>AppMsgType.dispatch</tt>)  to the robot-actor:

<pre>
suspend fun forward(  msg: AppMsg ){ <ks>robotActor</ks>.<k>send</k>( msg.toString()  ) }
...
forward( initMsg )
...
forward( moveForwardMsg )
delay(1000)
forward( haltRobotMsg )
</pre>

 
The task of translating the 'application level language' into  <em>cril</em>  and viceversa is delegated to
the <a href="../src/virtualRobotUsage/virtualRobotSupport.kt" target="code">virtualRobotSupport.kt</a> 
(see the functions <tt>translate</tt>, <tt>doApplMove</tt> and <tt>sendMsgToRobot</tt>).
<br/><br/>
In this way, the <a href="../src/virtualRobotUsage/robotActor.kt" target="code">robotActor.kt</a> is made independent
of the specific concrete robot to be used; 
the  role of the <a href="../src/virtualRobotUsage/virtualRobotSupport.kt" target="code">virtualRobotSupport.kt</a>
as a <a href="https://en.wikipedia.org/wiki/Translator_(computing)" target="web"><bc>language translator</bc></a> 
 can be viewed as a sort of
<a href="https://en.wikipedia.org/wiki/Adapter_pattern" target="web"><bc>adapter</bc></a>  in the message-passing world.

 

 
 
<h2>Towards more complex behavior</h2>
The <a href="../src/virtualRobotUsage/robotActorTry.kt" target="code">robotActorTry.kt</a> implements the business logic
related to each message it can receive. However, since it is an active entity, we can now extend its behavior  
so to satisfy the first requirement of our
<a href="http://htmlpreview.github.io/?https://github.com/anatali/iss2020LabBo/blob/master/it.unibo.issLabStart/userDocs/72939LabISSIntro.html#Application0" 
target="web">Application0</a>. For example,we can say that:
<hr/>
<i>the robot starts to explore in a systematic and autonomous way the room after receiving the command '<k>explore</k>' </i>.
<hr/>
As <em>analysts</em>, we can say that the problem to face now is the design and development of a behavior that msut be both <bc>proactive</bc> (the robot must perform
the exploration activity in autonomous way) and <bc>reactive</bc> 
(while exploring, the robot should not lose its capability to handle other messages, for example <k>end</k> and <k>collision</k>).
-->
 

<!--

<h2>USING WENV WITH ACTORS</h2>

<center><table style="width:95%">
<tbody>	
 
<tr>
<td style="width:40%">
<a href="clientWenvTcpObj.kt" target="code">RobotCmds.kt</a>
</td>
<td><m><em>Robot command messages</em></m></td>
</tr>

<tr>
<td style="width:40%">
<a href="../src/main/kotlin/it/unibo/robots19/basic/BasicRobotExecutor.kt" target="code">BasicRobotExecutor.kt</a>
</td> 
<td><m><em>Actor that executes commands</em> implemented by
<a href="../src/main/kotlin/it/unibo/robots19/basic/RobotCmds.kt" target="code">RobotCmds.kt</a></m></td>
</tr>

<tr>
<td style="width:40%">
<a href="../executorDescr.pl" target="code">executorDescr.pl</a>
</td>
<td><m><em>Description of a qak system </em> managed with 
<a href="../sysRules.pl" target="code">sysRules.pl</a>. A main is:
<a href="../src/main/kotlin/it/unibo/robots19/experiment/MainExecutor.kt" target="code">MainExecutor.kt</a>
</m></td>
</tr>


</tbody>	
</table></center>

<h3>Interacting with the BasicRobotExecutor </h3>
 
<center><table style="width:95%">
<tbody>	

<tr>
<td style="width:40%">
<a href="../src/main/kotlin/it/unibo/robots19/basic/ClientToRobotExecutor.js" target="code">ClientToRobotExecutor.js</a>
</td>
<td><m><em>Client Node  </em> for the 
<a href="../src/main/kotlin/it/unibo/robots19/basic/BasicRobotExecutor.kt" target="code">BasicRobotExecutor.kt</a>
 
 
</m></td>
</tr>

</tbody>	
</table></center>


<div class="req">
</div>	    
 	
	
	<h3>RESOURCES</h3>

    <a href="http://137.204.107.10/iss2018/it.unibo.issMaterial/issdocs/Material/2016-02-26-raspbian-jessie-iss.img.zip" 
								target="lecture">2016-02-26-raspbian-jessie-iss.img.zip</a> (<tt>WARNING: 1GB</tt>)<br/>
    <a href="../CARD/guida_rpi.pdf" target="lecture">guida_rpi.pdf</a>,<br/>
    <a href="../CARD/rpi_sd.pdf" target="lecture">rpi_sd.pdf</a>,<br/>
    <a href="../CARD/istruzioni-aggiornate-raspi-linux.pdf" target="lecture">istruzioni-aggiornate-raspi-linux.pdf (Giacomo Venturini)</a> 
	ed <a href="../CARD/esempio-procedura.html" target="lecture">esempio-procedura.html</a> ,<br/>
-->
<!-- 
<video controls>
   <source src="foo.ogg" type="video/ogg"> audio  
  <source src="firstactorvr.264" type="video">
  Your browser does not support the <code>video</code> element.
</video>
--> 




<hr/><hr/><hr/>

<h2>ActorBasicKotlin</h2>

<table style="width:98%">
<tbody>	

<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/actor0/ActorBasicKotlin.kt" target="code"><ks>ActorBasicKotlin.kt</ks></a>
<br/> 
When created, an actor stores a reference in the 
<a href="../app/src/main/kotlin/it/unibo/actor0/ActorBasicContextKb.kt" target="code"><ks>ActorBasicContextKb.kt</ks></a> 
<br/>
</td>
<td>
 <a href="../app/src/main/kotlin/it/unibo/actor0Usage/MainActor0Demo0.kt" target="code"><ks>MainActor0Demo0.kt</ks></a>
<ol>
<li>demoActivateActors</li>
<li>prodCons</li>
</ol> 
 
 
</td>
</tr>

<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/actor0/ActorBasicContextKb.kt" target="code"><ks>ActorBasicContextKb.kt</ks></a>
  <br/> 
  A kotlin object that keep track of actors
  <br/><br/>
</td>
<td>

  <a href="../app/src/main/kotlin/it/unibo/actor0Usage/MainDemoActorBasicWithContext.kt" target="code"><ks>MainDemoActorBasicWithContext.kt</ks></a>
<br/><br/>
</td>
</tr>

<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/actor0/ActorContextTcpServer.kt" target="code"><ks>ActorContextTcpServer.kt</ks></a>
 <br/><br/>
</td>
<td>
</td>
</tr>


<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/actor0/sysUtil.kt" target="code"><ks>sysUtil.kt</ks></a>
 <br/><br/>
</td>
<td>
</td>
</tr>




 </tbody>
</table>

<h2>Actor for robots</h2>

<table style="width:98%">
<tbody>	

<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/actor0robot/AbstractRobotActor.kt" target="code"><ks>AbstractRobotActor.kt</ks></a>
 <br/><br/>
</td>
<td>
</td>
</tr>

<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/actor0robot/StepRobotActor.kt" target="code"><ks>StepRobotActor.kt</ks></a>
 <br/><br/>
</td>
<td>
</td>
</tr>

<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/actor0robot/ExecutorActor.kt" target="code"><ks>ExecutorActor.kt</ks></a>
 <br/><br/>
</td>
<td>
</td>
</tr>


<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/actor0robot/RemoteRobotCaller.kt" target="code"><ks>RemoteRobotCaller.kt</ks></a>
 <br/><br/>
</td>
<td>
</td>
</tr>

 </tbody>
</table>

<h2>FSM</h2>

<table style="width:98%">
<tbody>	

<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/fsm/FsmBasic.kt" target="code"><ks>FsmBasic.kt</ks></a>
 <br/><br/>
</td>
<td>
</td>
</tr>
<tr>
<td style="width:50%" >
 <a href="../app/src/main/kotlin/it/unibo/fsm/FsmBasicUsage.kt" target="code"><ks>FsmBasicUsage.kt</ks></a>
 <br/><br/>
</td>
<td>
</td>
</tr>


 </tbody>
</table>


<h2>IssWsHttpKotlinSupport</h2>
<table style="width:98%">
<tbody>	

<tr>
<td style="width:50%" >
  <a href="../app/src/main/kotlin/it/unibo/supports/IssWsHttpKotlinSupport.kt" target="code"><ks>IssWsHttpKotlinSupport.kt</ks></a>
<br/><br/>
  
</td>
<td>
 

</td>
</tr>

<tr>
<td style="width:50%" >
<h3>The resumableBoundaryWalker as a <a href="../../it.unibo.virtualrobotclient/userDocs/fsm.html" target="info"><k>Finite State Machine</k></a></h3> 
<a href="../../it.unibo.virtualrobotclient/app/src/main/java/it/unibo/resumablebwWithActor/ResumableBoundaryWalkerActor.java" target="code">
ResumableBoundaryWalkerActor.java</a> 
 
<br/><br/>
 
<center><img src="./img/bwArch.png" alt="bwArch" width="90%" ></center> 



</td>
<td> 

<h4>UML-like model after coding  </h4>
<center><img src="./img/resumablebwMealy.png" alt="resumablebwMealy" width="90%" ></center> 
<br/><br/>
 <m>
<ul>
<li>The fsm is activated with an input each time the <ks>handleInput</ks> receives a message <tt>endmove</tt> 
(sent by the <a href="../app/src/main/kotlin/it/unibo/supports/IssWsHttpKotlinSupport.kt" target="code"><ks>IssWsHttpKotlinSupport.kt</ks></a>)
 or <tt>robotcmd</tt> 
(sent by the <a href="../../it.unibo.virtualrobotclient/app/src/main/java/it/unibo/consolegui/ConsoleGuiActorKotlin.java" target="code">
<ks>ConsoleGuiActorKotlin.java</ks></a>). </li>
<li>A state transition with action <k>doStep</k> is performed only if the boolean variable <ks>tripStopped</ks> is <tt>false</tt>.</li>
<li>The variable <ks>tripStopped</ks> is set to <tt>true</tt> when the user presses the <tt>STOP</tt> button.</li>
<li>When the user presses the <tt>RESUME</tt> button, the <ks>handleInput</ks>  activates the fsm 
(blocked in the state <em>walking</em> or in the state <em>obstacle</em>) with input <tt>resume</tt>. </li>

</ul>
</m>
</td>
</tr>

 


 </tbody>
</table>




   <!--
<ol>
<li></li>
<li></li>
<li></li>
</ol>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
 

</td>
<td>
</td>
</tr>
 </tbody>
</table>
-->
	      	
<br/><br/> 	
</div>  

<div style="background-color:rgba(86, 56, 253, 0.9); width:100%;text-align:center;font-size:small;color:white">
By AN Unibo-DISI  
</div>
</body>
</html>